<!DOCTYPE html>
<html>

<head>
  <link rel="stylesheet" href="globals.css" />
  <link rel="stylesheet" href="styleguide.css" />
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div class="cadastro-login">
    <div class="div">
      <div class="frame-cadastro-login">
        <div class="frame-cadastro">
          <div class="text-wrapper">Cadastro</div>
          <input class="text-wrapper-2" placeholder="Nome" id="nomeCadastro"></input>
          <input class="text-wrapper-2" placeholder="Endereço" id="enderecoCadastro"></input>
          <input class="text-wrapper-2" placeholder="Email" id="emailCadastro"></input>
          <input type="password" class="text-wrapper-2" placeholder="Senha" id="senhaCadastro"></input>
          <button class="button" onclick="registrar()">
            <img class="button" src="img/btn-criar-conta.png" />
          </button>
        </div>
        <div class="frame-login">
          <div class="text-wrapper-3">Login</div>
          <input class="text-wrapper-2" placeholder="Email" id="emailLogin"></input>
          <input type="password" class="text-wrapper-2" placeholder="Senha" id="senhaLogin"></input>
          <button class="button" onclick="logar()">
            <img class="btn-logar" src="img/btn-logar.png" />
          </button>
        </div>
      </div>
      <div class="overlap-group">
        <div class="menu-superior">
          <a href="../carrinho/index.html"> <img class="cart-2" src="img/cart.png" /></a>
          <a href="../cadastro-login/index.html"><img class="icone-usuario" src="img/icone-usuario.png" /></a>
        </div>
        <a href="../index/index.html"><img class="logo-home" src="img/logo-home.png" /></a>
      </div>
    </div>
  </div>
</body>

</html>
<script>

  function elementosCadastro() {
    let nome = document.getElementById('nomeCadastro').value;
    let email = document.getElementById('emailCadastro').value;
    let endereco = document.getElementById('enderecoCadastro').value;
    let senha = document.getElementById('senhaCadastro').value;

    return {
      nomeCliente: nome,
      Endereco: endereco,
      email: email,
      Senha: senha
    }
  }

  async function registrar() {
    const response = await fetch('http://localhost:4877/Cliente/criarNovo',
      {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(elementosCadastro())
      }
    )

    if (response.ok) {
      alert('Cadastro realizado com sucesso.')
    }
    else {
      alert('Erro no cadastro. Favor tentar novamente.')

    }
  }

  async function logar() {
    var user = document.getElementById('emailLogin').value;
    var pass = document.getElementById('senhaLogin').value;

    if (user == "" || pass == "") {
      alert('Preencha os dados de login')
    }
    else {
      try {
        const response = await fetch(`http://localhost:4877/Auth/auth?user=${user}&pass=${pass}`,
          { method: 'POST' })
        // .then(response => response.json())
        // .then(x => sessionStorage.setItem('token', x.token))

        if (response.ok) {
          response.json().then(x => sessionStorage.setItem('token', x.token))
          alert('Login realizado com sucesso. Faça seus pedidos');
          location.href = "../index/index.html";
        }
        else {
          alert('Erro no login. Gentileza avaliar suas credenciais e tentar novamente.dentu')
        }
      }
      catch {
        alert('Erro no login. Gentileza avaliar suas credenciais e tentar novamente.')
      }
    }
  }


</script>